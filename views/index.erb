<canvas id='grid' width="150" height="150" style="border: 1px solid #000000;"></canvas>

<script src='javascript/jquery.min.js'></script>
<script>
  function draw_grid(grid){
    var c=document.getElementById("grid");
    var ctx=c.getContext("2d");

    // draw white blank
    ctx.fillStyle="#ffffff";
    ctx.fillRect(0,0,150,150);

    // draw lines
    ctx.strokeStyle = "#b2b2b2";
    for(var k=1; k<15; k++){
      ctx.moveTo(0,10*k);
      ctx.lineTo(150,10*k);
      ctx.stroke();
      ctx.moveTo(10*k,0);
      ctx.lineTo(10*k,150);
      ctx.stroke();
    }

    // draw cells
    ctx.fillStyle="#000000";
    for(var i=0; i<grid.length; i++){
      for(var j=0; j<grid[0].length; j++){
        if(grid[i][j] == 1){
          ctx.fillRect(i*10,j*10,10,10);
        }
      }
    }
  }

  function parse_array(string){
    var size = Math.sqrt(string.length);
    var a = new Array(size);
    for(var k=0; k<size; k++){
      a[k] = new Array(size);
    }

    for(var j=0; j<size; j++){
      for(var i=0; i<size; i++){
        a[j][i] = parseInt(string.charAt(size*j + i));
      }
    }
    return a;
  }

  $(document).ready(function(){
    next_grid = <%= @grid %>;
    setInterval(function(){
      $.post('/', {grid: next_grid}, function(data){
        next_grid = parse_array(data);
        draw_grid(next_grid);
      });
    }, 1000);
  });
</script>
